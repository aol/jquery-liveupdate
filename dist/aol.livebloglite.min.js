/*! AOL Liveblog Lite - v0.1.0 - 2012-09-17
* https://github.com/aol/liveblog-widget
* Copyright (c) 2012 Nate Eagle; Licensed MIT, GPL */
(function(e){e.fn.liveBlogLiteApi=function(t){var n=this,r=arguments,i={callbackPrefix:"lb_"+(new Date).getTime()+"_",url:null,postId:null},s=n.data("lbl-state")||{},o={init:function(t){s.lastUpdate=0,s.count=0,s.options=e.extend(!0,{},i,t),n.data("lbl-state",s),o.fetch()},fetch:function(){var t,r=n.data("lbl-state"),i=r.options,s=i.callbackPrefix+r.count,u=function(e,t){var n,r,i,s,o,u={},a=e,f={1:"text",2:"image",4:"comment"};for(n=0,r=t.length;n<r;n+=1)o=t[n],u[o.m]={name:o.name,slug:o.slug};for(s in a)if(a.hasOwnProperty(s))for(n=0,r=a[s].length;n<a[s].length;n+=1)i=a[s][n],i.m&&(i.memberId=i.m,i.memberName=u[i.memberId].name,i.memberSlug=u[i.memberId].slug,delete i.m),i.t&&(i.date=new Date(i.t*1e3),delete i.t),i.type&&(i.type=f[i.type]||"unknown"),i.d&&(i.content=i.d,delete i.d),i.md&&i.md.caption&&(i.caption=i.md.caption||"",delete i.md.caption),i.md&&i.md.tags&&(i.tags=i.md.tags||[],delete i.md.tags);return a};i.url.substring(i.url.length-1)!=="/"&&(i.url+="/"),t=i.url+"live-update/"+i.postId+"/"+r.lastUpdate,e.ajax({dataType:"jsonp",jsonpCallback:s,url:t,success:function(e){r.lastUpdate=e.last_update,n.data("timer",setTimeout(o.fetch,e.int*1e3)),r.count+=1,e.data&&e.members&&n.trigger("update",u(e.data,e.members)),n.data("lbl-state",r)},error:function(e){n.data("timer",setTimeout(o.fetch,1e4))}})},pause:function(){var e=s.paused||!1;e?(s.paused=!1,o.fetch()):(s.paused=!0,clearTimeout(n.data("timer"))),n.data("lbl-state",s)}};return this.each(function(){if(o[t])return o[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||!t)return o.init.apply(this,r);e.error("Method "+t+" does not exist on jQuery.liveBlogApi.")})}})(jQuery),function(e){e.fn.liveBlogLiteUi=function(t){var n={postId:null,url:null},r=e(this),i=function(t){if(e.fn.liveBlogLiteApi){var i=e.extend(!0,{},n,t),s=function(t,n){var r=t.content,i=t.type,s=t.id,o=t.caption,u=t.tags,a=t.date,l=t.memberId,c=f(a)+" by "+t.memberName;n?n.empty():n=e("<p />",{id:"p"+s,"class":"lb-post"}),i==="text"||i==="comment"?(n.append(e("<span />",{text:r,"class":"lb-post-text"})),i==="comment"&&n.addClass("lb-comment")):i==="image"&&n.append(e("<span />",{text:o,"class":"lb-post-caption"}),e("<img />",{src:r,height:100})),n.append(e("<span />",{text:c,"class":"lb-post-timestamp"}));if(t.tags&&t.tags.length){var h=e("<ul />",{"class":"lb-post-tags"}).appendTo(n);e.each(t.tags,function(t,n){h.append(e("<li />",{text:n}))})}return n},o=function(t){var n=s(t);n&&(n.hide(),t.type==="comment"&&t.p?n.insertAfter(e("#p"+t.p)):n.prependTo(r),n.fadeIn(400))},u=function(t){var n=e("#p"+t.id,r);n.length&&(n=s(t,n),n&&n.hide().fadeIn(400))},a=function(t){var n=e("#p"+t.id,r);n.length&&n.fadeOut(400,"swing",function(){n.remove()})},f=function(e){e=new Date(e);var t="am",n=e.getHours(),r=e.getMinutes(),i="",s="",o="",u=new Date,a=new Date(u.getFullYear(),u.getMonth(),u.getDate());return n>=12&&(t="pm"),n===0?n=12:n>12&&(n-=12),r<10&&(r="0"+r),i=n+":"+r+t,s=e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear(),e.getTime()>=a.getTime()?o=i:o=s+", "+i,o};r.liveBlogLiteApi(i),r.addClass("lb"),r.bind("update",function(t,n){e(n.updates).each(function(e,t){o(t)}),e(n.changes).each(function(e,t){u(t)}),e(n.deletes).each(function(e,t){a(t)})})}};return this.each(function(){t=t||{},i(t)})}}(jQuery);