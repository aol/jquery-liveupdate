(function(e){e.fn.liveBlogLiteUi=function(t){var n={toolbarEnabled:!1,pageSize:0,tweetButtons:!0,height:0,linkParams:null,thumbnails:!0,dims:!0,thumbnailDimensions:{height:100,width:null}},r=function(e){var t=document.createElement("DIV");return t.innerHTML=e,t.textContent||t.innerText},i=e(this),s=function(t){if(e.fn.liveBlogLiteApi){var s=e.extend(!0,{},n,t),o=!1,u=window.location.hash;if(u.length){var a,f,l=u.indexOf("tag=");l>-1&&(f=l+4,a=u.substring(f,u.length),a=decodeURIComponent(a),s.tagFilter=a)}s.linkParams&&(s.linkParams.charAt(0)==="?"||s.linkParams.charAt(0)==="&")&&(s.linkParams=s.linkParams.substr(1)),i.bind("begin",function(t){i.empty();var n=!0,u=s.pageSize,a=[],f=0,l=0,c=null,h=null,p=null,d=null,v=null,m=null,g=null,y,b=0,w=!1,E=function(t,n){var i=t.content,o=t.type,u=t.id,a=t.caption,f=t.tags,l=t.date,c=t.memberId,h='<a href="#p'+u+'">'+O(l)+"</a> by "+t.memberName,p,d,v,m,g;if(s.tagFilter&&f&&e.inArray(s.tagFilter,f)===-1)return[];n?n.empty():n=e("<p />",{id:"p"+u,"class":"lb-post"}).data("date",t.date.getTime()),o==="text"||o==="comment"?(n.append(S(i,"lb-post-text")),o==="comment"?n.addClass("lb-comment"):n.data("comments")||n.data("comments",0)):o==="image"&&(s.thumbnails?(d=i,s.dims?p=e.getDynamicImageSrc(i,s.thumbnailDimensions.width,s.thumbnailDimensions.height):p=i.replace(/(\.gif|\.jpg|\.jpeg|\.png)$/,"_thumbnail$1")):p=i,n.append(e("<img />",{src:p,"data-src":d||"",alt:a?r(a):""}),S(a,"lb-post-caption"))),n.append(g=e("<span />",{"class":"lb-post-info"}).append(e("<span />",{html:h,"class":"lb-post-timestamp"})));if(t.tags&&t.tags.length){var y=e("<ul />",{"class":"lb-post-tags"}).appendTo(g);e.each(t.tags,function(t,n){y.append(e("<li />",{html:'<a href="#tag='+encodeURIComponent(n)+'" class="tag">'+n+"</a>","class":t===0?"lb-first":null}))})}return s.tweetButtons&&(m=a||i,v=M(u,m),n.bind("mouseenter",function(e){n.unbind("mouseenter"),g.append(v),twttr.widgets.load()})),n},S=function(t,n){n=n||"lb-post-text";var r;return t&&(t=t.replace(/<script[^>]*>.*?<\/script>/ig,"")),r=e("<span />",{html:t,"class":n}),r.find("a").attr("target","_blank"),s.linkParams&&r.find("a[href]").each(function(t,n){var r=e(n),i=r.attr("href"),o=i.indexOf("#"),u=(i.indexOf("?")===-1?"?":"&")+s.linkParams;o!==-1?i=i.substring(0,o)+u+i.substring(o):i+=u,r.attr("href",i)}),r.find("object, embed, applet, iframe, frame, input, select, textarea").remove(),r},x=function(t,n){var r=e("#p"+t.id,d),i=null,s=0,o=d.scrollTop(),u;r.length||(r=E(t),r.length&&(r.hide(),t.type==="comment"&&t.p?(i=e("#p"+t.p,d),i.length?(r.data("date",i.data("date")),r.insertAfter(i),r.next(".lb-comment").andSelf().last().addClass("lb-comment-last").prev().removeClass("lb-comment-last"),i.data("comments",i.data("comments")+1),i.data("comments")>0&&(u=i.find(".lb-post-comments-label"),u.length||i.append(u=e("<span />",{"class":"lb-post-comments-label",text:"Comments"})))):a.push(t)):n&&n.length?r.insertAfter(n):r.prependTo(d),s=r.outerHeight(),s&&o&&d.scrollTop(o+s),r.fadeIn(400)))},T=function(t){var n=e("#p"+t.id,d),r=0,i=0,s=0,o=d.scrollTop();n.length?(r=n.outerHeight(),n=E(t,n),n&&(i=n.outerHeight(),s=i-r,s&&o&&d.scrollTop(o+s),n.hide().fadeIn(400))):_(t.id,t)},N=function(t){var n=e("#p"+t.id,d),r=0,i=d.scrollTop(),s=null;n.length?(r=n.outerHeight(),n.fadeOut(400,"swing",function(){n.hasClass("lb-comment-last")&&n.prev(".lb-comment").addClass("lb-comment-last"),n.hasClass("lb-comment")&&(s=n.prevAll(".lb-post:not(.lb-comment):first"),s.data("comments",s.data("comments")-1),s.data("comments")===0&&s.find(".lb-post-comments-label").remove()),n.remove(),r&&i&&d.scrollTop(i-r)})):_(t.id,null)},C=function(t){t=t||[];var n=t.length,r=0;u>0&&n>u&&!a.length&&!d.children(".lb-post").length&&(a=t.splice(0,n-u),d.append(e("<a />",{"class":"lb-more-button lb-button",text:"Show earlier posts"})).click(e.proxy(k,this))),e(t).each(function(e,t){x(t);if(t.type!=="comment"&&t.date){var n=t.date.getTime();f=Math.min(f,n),l=Math.max(l,n)}})},k=function(t){var n=e(t.target),r=a.length,i=null,s=0,o=null;r&&(i=d.children(".lb-post:last"),s=Math.max(r-u,0),o=a.splice(s,u),e(o).each(function(e,t){x(t,i)})),a.length||n.remove()},L=function(t){var n=e("#p"+t,d);o=!0,n.length&&d.stop().animate({scrollTop:n.get(0).offsetTop},{duration:"fast",complete:function(){o=!1}})},A=function(t){var n=null;return d.children(".lb-post:not(.lb-comment)").each(function(r,i){var s=e(i);if(s.data("date")===t||s.data("date")<t&&s.prev().data("date")>t)return n=s,!1}),n},O=function(e){e=new Date(e);var t="am",n=e.getHours(),r=e.getMinutes(),i="",s="",o="",u=new Date,a=new Date(u.getFullYear(),u.getMonth(),u.getDate());return n>=12&&(t="pm"),n===0?n=12:n>12&&(n-=12),r<10&&(r="0"+r),i=n+":"+r+t,s=e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear(),e.getTime()>=a.getTime()?o=i:o=s+", "+i,o},M=function(t,n){var i=window.location.href.replace(/\#.*$/,""),s=e("<a />",{"data-count":"none","data-text":'"'+r(n)+'"',"data-url":i+"#p"+t,href:"https://twitter.com/share","class":"twitter-share-button"}),o=document.createElement("DIV");return o.innerHtml=n,s},_=function(e,t){if(a.length)for(var n=0;n<a.length;n++)if(a[n].id===e){t?a[n]=t:(a[n]=null,a.splice(n,1));break}},D=function(t){var r=e(t.target);n?(P(),r.text("Pause"),v.removeClass("lb-status-paused")):(H(),r.text("Resume"),v.addClass("lb-status-paused")),B()},P=function(){i.liveBlogLiteApi("play"),n=!1},H=function(){i.liveBlogLiteApi("pause"),n=!0},B=function(e){g&&(g.removeClass("lb-status-live"),e===!1?g.text("").hide():(n?g.text("Paused"):g.text("Live!").addClass("lb-status-live"),g.show()))},j=function(){m&&(m.slider("option",{min:f,max:l,disabled:!1}),d.scroll())},F=function(t){if(m){t=t||m.slider("value");var n=new Date(t),r=O(n);e(".lb-timeline-label",v).text(r)}},I=function(e){m&&(m.slider("value",e),F())},q=function(t){var n=e(t||window),r=null;return n.children(".lb-post").each(function(t,n){var i=e(n),s=i.height(),o=i.position().top,u=o+s;if(o<=0&&u>0)return r=i,!1}),r},R=function(e){var t=q(d);t&&(t.hasClass("lb-top")||(d.children(".lb-top").removeClass("lb-top"),t.addClass("lb-top")),o||I(t.data("date"))),d.scrollTop()===0&&z(0)},U=function(e,t){F(t.value);var n=A(t.value);n&&L(n.attr("id").substr(1))},z=function(e){b=e,y.html("<b>"+e+"</b> new update"+(e!==1?"s":"")).toggle(e>0),e>0?c.slideDown(300):Boolean(s.tagFilter)||c.slideUp(300)},W=function(){s.tagFilter="",window.location.hash="_",i.liveBlogLiteApi("reset"),i.trigger("begin")};i.addClass("lb"),s.toolbarEnabled&&(i.append(v=e("<div />",{"class":"lb-toolbar"}).append(e("<a />",{"class":"lb-pause-button lb-button",text:"Pause"}).bind("click",e.proxy(D,this)),e("<div />",{"class":"lb-timeline"}).append(e("<p />",{"class":"lb-timeline-label",text:"Waiting for updates..."}),m=e("<div />",{"class":"lb-timeline-slider"})),g=e("<span />",{"class":"lb-status"}).hide())),m.slider({slide:U,disabled:!0})),c=e("<div />",{"class":"lb-alert"}).appendTo(i).append(y=e("<a />",{"class":"lb-unread-count"}).hide().click(function(e){e.preventDefault(),s.tagFilter?W():d.stop().animate({scrollTop:0},{duration:"fast"})})).hide(),s.tagFilter&&(c.show().append(h=e("<span />",{"class":"lb-tag-filter",html:"Showing all updates with the <b>"+s.tagFilter+"</b> tag. "})),p=e("<a />",{href:"#",text:"View all updates"}).appendTo(h).bind("click",function(e){e.preventDefault(),W()})),d=e("<div />",{"class":"lb-post-container"}).appendTo(i).scroll(e.throttle(250,R)),s.height&&s.height>0&&d.height(s.height),i.bind("update",function(t,n){var r=window.location.hash,i=0;n.updates&&(f===0&&(f=(new Date).getTime()),C(n.updates),j(),w&&(d.scrollTop()>0?i=n.updates.length:s.tagFilter&&e.each(n.updates,function(t,n){if(!n.tags||n.tags&&e.inArray(s.tagFilter,n.tags)===-1)i+=1}),i>0&&z(b+i))),e(n.changes).each(function(e,t){T(t)}),n.deletes&&e(n.deletes).each(function(t,n){var r=e("#p"+n.id),i,s;r.length&&!r.hasClass("lb-comment")&&(i=r.data("date"),i===f&&(s=r.prev(":not(.lb-comment)"),s.length&&(f=s.data("date"))),i===l&&(s=r.next(":not(.lb-comment)"),s.length&&(l=s.data("date"))),j()),N(n)});if(r.length){var o,u,a=r.indexOf("p");a>-1&&(u=a+1,o=r.substring(u,r.length),L(o))}w=!0}),i.bind("end",function(t){e(".lb-pause-button",i).hide(),B(!1)}),s.alive===!1||s.end&&s.end<=new Date?(e(".lb-pause-button",i).hide(),B(!1)):(n=!1,B())}),i.delegate(".tag","click",function(t){s.tagFilter=e(t.currentTarget).text(),i.liveBlogLiteApi("reset"),i.unbind("end update"),i.trigger("begin")}),i.delegate("img","click",function(t){var n=e(t.currentTarget),r=n.attr("data-src"),i=e("<img />",{src:r?r:n.attr("src")}),s=e("<div />");i.bind("load",function(t){var r=e(t.currentTarget);s.append(r),s.dialog({height:"auto",modal:!0,title:n.attr("alt"),width:"auto"}),e(".ui-widget-overlay").bind("click",function(e){s.dialog("destroy")})}),s.prependTo("body")}),e.browser.msie&&parseInt(e.browser.version,10)<=6&&i.delegate(".lb-button","hover",function(t){e(this).toggleClass("lb-hover")}),s.tweetButtons&&(typeof twttr=="undefined"&&function(e,t,n){var r,i=e.getElementsByTagName(t)[0];e.getElementById(n)||(r=e.createElement(t),r.id=n,r.src="http://platform.twitter.com/widgets.js",i.parentNode.insertBefore(r,i))}(document,"script","twitter-wjs"),i.delegate(".lb-post","mouseenter",function(t){e(t.currentTarget).find(".twitter-share-button").fadeIn("fast")}),i.delegate(".lb-post","mouseleave",function(t){e(t.currentTarget).find(".twitter-share-button").fadeOut("fast")})),i.liveBlogLiteApi(s)}};return this.each(function(){t=t||{},s(t)})}})(jQuery);