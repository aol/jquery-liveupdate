(function(e){e.fn.liveBlogLiteUi=function(t){var n={postId:null,url:null,toolbarEnabled:!1,pageSize:0,tweetButtons:!0},r=e(this),i=function(t){if(e.fn.liveBlogLiteApi){var i=e.extend(!0,{},n,t),s=!0,o=i.pageSize,u=[],a=null,f=null,l=null,c=null,h=null,p=function(t,n){var r=t.content,s=t.type,o=t.id,u=t.caption,a=t.tags,f=t.date,l=t.memberId,c='<a href="#p'+o+'">'+w(f)+"</a> by "+t.memberName,h,p;n?n.empty():n=e("<p />",{id:"p"+o,"class":"lb-post"}).data("date",t.date.getTime()),s==="text"||s==="comment"?(n.append(e("<span />",{text:r,"class":"lb-post-text"})),s==="comment"&&n.addClass("lb-comment")):s==="image"&&n.append(e("<span />",{text:u,"class":"lb-post-caption"}),e("<img />",{src:r,height:100})),n.append(e("<span />",{html:c,"class":"lb-post-timestamp"})),i.tweetButtons&&(p=u||r,h=E(o,r),n.bind("mouseenter",function(e){n.unbind("mouseenter"),n.find(".lb-post-timestamp").append(h),twttr.widgets.load()}));if(t.tags&&t.tags.length){var d=e("<ul />",{"class":"lb-post-tags"}).appendTo(n);e.each(t.tags,function(t,n){d.append(e("<li />",{text:n}))})}return n},d=function(t,n){var r=e("#p"+t.id,l),i=null;r.length||(r=p(t),r.length&&(r.hide(),t.type==="comment"&&t.p?(i=e("#p"+t.p,l),i.length?r.insertAfter(i):u.push(t)):n&&n.length?r.insertAfter(n):r.prependTo(l),r.fadeIn(400)))},v=function(t){var n=e("#p"+t.id,l);n.length?(n=p(t,n),n&&n.hide().fadeIn(400)):S(t.id,t)},m=function(t){var n=e("#p"+t.id,l);n.length?n.fadeOut(400,"swing",function(){n.remove()}):S(t.id,null)},g=function(t){t=t||[];var n=t.length,r=0;o>0&&n>o&&!u.length&&!l.children(".lb-post").length&&(u=t.splice(0,n-o),l.append(e("<a />",{"class":"lb-more-button",text:"Show earlier posts"})).click(e.proxy(y,this))),e(t).each(function(e,t){d(t)})},y=function(t){var n=e(t.target),r=u.length,i=null,s=0,a=null;r&&(i=l.children(".lb-post:last"),s=Math.max(r-o,0),a=u.splice(s,o),e(a).each(function(e,t){d(t,i)})),u.length||n.remove()},b=function(t){var n=e("#p"+t,l);n.length},w=function(e){e=new Date(e);var t="am",n=e.getHours(),r=e.getMinutes(),i="",s="",o="",u=new Date,a=new Date(u.getFullYear(),u.getMonth(),u.getDate());return n>=12&&(t="pm"),n===0?n=12:n>12&&(n-=12),r<10&&(r="0"+r),i=n+":"+r+t,s=e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear(),e.getTime()>=a.getTime()?o=i:o=s+", "+i,o},E=function(t,n){var r=i.url+window.location.pathname.substring(1,window.location.pathname.length),s=e("<a />",{"data-count":"none","data-text":'"'+n+'"',"data-url":r+"#p"+t,href:"https://twitter.com/share","class":"twitter-share-button"});return s},S=function(e,t){if(u.length)for(var n=0;n<u.length;n++)if(u[n].id===e){t?u[n]=t:(u[n]=null,u.splice(n,1));break}},x=function(t){var n=e(t.target);s?(T(),n.text("Pause")):(N(),n.text("Resume"))},T=function(){r.liveBlogLiteApi("play"),s=!1},N=function(){r.liveBlogLiteApi("pause"),s=!0},C=function(){h&&(h.slider("option",{min:a,max:f}),l.scroll())},k=function(t){if(h){t=t||h.slider("value");var n=new Date(t),r=w(n);e(".lb-timeline-label",c).text(r)}},L=function(e){h&&(h.slider("value",e),k())},A=function(t){var n=e(t||window),r=null;return n.children(".lb-post").each(function(t,n){var i=e(n),s=i.height(),o=i.position().top,u=o+s;if(o<=0&&u>0)return r=i,!1}),r},O=function(e){var t=A(l);t&&(t.hasClass("lb-top")||(l.children(".lb-top").removeClass("lb-top"),t.addClass("lb-top")),L(t.data("date")))};r.addClass("lb"),i.toolbarEnabled&&(r.append(c=e("<div />",{"class":"lb-toolbar"}).append(e("<a />",{"class":"lb-pause-button",text:"Pause"}).bind("click",e.proxy(x,this)),e("<div />",{"class":"lb-timeline"}).append(e("<p />",{"class":"lb-timeline-label",text:" "}),h=e("<div />",{"class":"lb-timeline-slider"})))),h.slider({slide:function(e,t){k(t.value)}})),l=e("<div />",{"class":"lb-post-container"}).appendTo(r).scroll(O),r.bind("update",function(t,n){var r=window.location.hash;if(n.updates){var i=n.updates,s=n.updates.length;g(i),a||(a=i[0].date.getTime()),f=Math.max(f||0,i[s-1].date.getTime()),C()}e(n.changes).each(function(e,t){v(t)}),e(n.deletes).each(function(e,t){m(t)});if(r.length){var o,u,l=r.indexOf("p");l>-1&&(u=l+1,o=r.substring(u,r.length),b(o))}}),i.tweetButtons&&(function(e,t,n){var r,i=e.getElementsByTagName(t)[0];e.getElementById(n)||(r=e.createElement(t),r.id=n,r.src="http://platform.twitter.com/widgets.js",i.parentNode.insertBefore(r,i))}(document,"script","twitter-wjs"),r.delegate(".lb-post","mouseenter",function(t){e(t.currentTarget).find(".twitter-share-button").fadeIn("fast")}),r.delegate(".lb-post","mouseleave",function(t){e(t.currentTarget).find(".twitter-share-button").fadeOut("fast")})),r.liveBlogLiteApi(i),s=!1}};return this.each(function(){t=t||{},i(t)})}})(jQuery);