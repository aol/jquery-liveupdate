(function(e){e.fn.liveBlogLiteUi=function(t){var n={postId:null,url:null,toolbarEnabled:!1,pageSize:0,tweetButtons:!0,height:0},r=e(this),i=function(t){if(e.fn.liveBlogLiteApi){var i=e.extend(!0,{},n,t),s=window.location.hash;if(s.length){var o,u,a=s.indexOf("tag=");a>-1&&(u=a+4,o=s.substring(u,s.length),o=decodeURIComponent(o),i.tagFilter=o)}r.bind("begin",function(t){r.empty();var n=!0,s=i.pageSize,o=[],u=0,a=0,f=null,l=null,c=null,h=null,p=null,d=null,v=function(t,n){var r=t.content,s=t.type,o=t.id,u=t.caption,a=t.tags,f=t.date,l=t.memberId,c='<a href="#p'+o+'" class="permalink">'+x(f)+"</a> by "+t.memberName,h,p,d;if(i.tagFilter&&a&&e.inArray(i.tagFilter,a)===-1)return[];n?n.empty():n=e("<p />",{id:"p"+o,"class":"lb-post"}).data("date",t.date.getTime()),s==="text"||s==="comment"?(n.append(e("<span />",{html:r,"class":"lb-post-text"})),s==="comment"&&n.addClass("lb-comment")):s==="image"&&n.append(e("<img />",{src:r}),e("<span />",{html:u,"class":"lb-post-caption"})),n.append(d=e("<span />",{"class":"lb-post-info"}).append(e("<span />",{html:c,"class":"lb-post-timestamp"})));if(t.tags&&t.tags.length){var v=e("<ul />",{"class":"lb-post-tags"}).appendTo(d);e.each(t.tags,function(t,n){v.append(e("<li />",{html:'<a href="#tag='+encodeURIComponent(n)+'" class="tag">'+n+"</a>","class":t===0?"lb-first":null}))})}return i.tweetButtons&&(p=u||r,h=T(o,p),n.bind("mouseenter",function(e){n.unbind("mouseenter"),d.append(h),twttr.widgets.load()})),n},m=function(t,n){var r=e("#p"+t.id,c),i=null,s=0,u=c.scrollTop();r.length||(r=v(t),r.length&&(r.hide(),t.type==="comment"&&t.p?(i=e("#p"+t.p,c),i.length?(r.data("date",i.data("date")),r.insertAfter(i),r.next(".lb-comment").andSelf().last().addClass("lb-comment-last").prev().removeClass("lb-comment-last")):o.push(t)):n&&n.length?r.insertAfter(n):r.prependTo(c),s=r.outerHeight(),s&&u&&c.scrollTop(u+s),r.fadeIn(400)))},g=function(t){var n=e("#p"+t.id,c),r=0,i=0,s=0,o=c.scrollTop();n.length?(r=n.outerHeight(),n=v(t,n),n&&(i=n.outerHeight(),s=i-r,s&&o&&c.scrollTop(o+s),n.hide().fadeIn(400))):N(t.id,t)},y=function(t){var n=e("#p"+t.id,c),r=0,i=c.scrollTop();n.length?(r=n.outerHeight(),n.fadeOut(400,"swing",function(){n.hasClass("lb-comment-last")&&n.prev(".lb-comment").addClass("lb-comment-last"),n.remove(),r&&i&&c.scrollTop(i-r)})):N(t.id,null)},b=function(t){t=t||[];var n=t.length,r=0;s>0&&n>s&&!o.length&&!c.children(".lb-post").length&&(o=t.splice(0,n-s),c.append(e("<a />",{"class":"lb-more-button",text:"Show earlier posts"})).click(e.proxy(w,this))),e(t).each(function(e,t){m(t);if(t.type!=="comment"&&t.date){var n=t.date.getTime();u=Math.min(u,n),a=Math.max(a,n)}})},w=function(t){var n=e(t.target),r=o.length,i=null,u=0,a=null;r&&(i=c.children(".lb-post:last"),u=Math.max(r-s,0),a=o.splice(u,s),e(a).each(function(e,t){m(t,i)})),o.length||n.remove()},E=function(t){var n=e("#p"+t,c);console.log("gotoitem",t),c.find(".active").removeClass("active"),n.addClass("active").css("opacity",0).animate({opacity:1},"slow"),console.log(n),n.length&&(console.log("scroll me"),c.scrollTop(n.get(0).offsetTop))},S=function(t){var n=null;return c.children(".lb-post:not(.lb-comment)").each(function(r,i){var s=e(i);if(s.data("date")===t||s.data("date")<t&&s.prev().data("date")>t)return n=s,!1}),n},x=function(e){e=new Date(e);var t="am",n=e.getHours(),r=e.getMinutes(),i="",s="",o="",u=new Date,a=new Date(u.getFullYear(),u.getMonth(),u.getDate());return n>=12&&(t="pm"),n===0?n=12:n>12&&(n-=12),r<10&&(r="0"+r),i=n+":"+r+t,s=e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear(),e.getTime()>=a.getTime()?o=i:o=s+", "+i,o},T=function(t,n){var r=window.location.href.replace(/\#.*$/,""),i=function(e){var t=document.createElement("DIV");return t.innerHTML=e,t.textContent||t.innerText},s=e("<a />",{"data-count":"none","data-text":'"'+i(n)+'"',"data-url":r+"#p"+t,href:"https://twitter.com/share","class":"twitter-share-button"}),o=document.createElement("DIV");return o.innerHtml=n,s},N=function(e,t){if(o.length)for(var n=0;n<o.length;n++)if(o[n].id===e){t?o[n]=t:(o[n]=null,o.splice(n,1));break}},C=function(t){var r=e(t.target);n?(k(),r.text("Pause"),h.removeClass("lb-status-paused")):(L(),r.text("Resume"),h.addClass("lb-status-paused")),A()},k=function(){r.liveBlogLiteApi("play"),n=!1},L=function(){r.liveBlogLiteApi("pause"),n=!0},A=function(e){d&&(d.removeClass("lb-status-live"),e===!1?d.text("").hide():(n?d.text("Paused"):d.text("Live!").addClass("lb-status-live"),d.show()))},O=function(){p&&(p.slider("option",{min:u,max:a,disabled:!1}),c.scroll())},M=function(t){if(p){t=t||p.slider("value");var n=new Date(t),r=x(n);e(".lb-timeline-label",h).text(r)}},_=function(e){p&&(p.slider("value",e),M())},D=function(t){var n=e(t||window),r=null;return n.children(".lb-post").each(function(t,n){var i=e(n),s=i.height(),o=i.position().top,u=o+s;if(o<=0&&u>0)return r=i,!1}),r},P=function(e){var t=D(c);t&&(t.hasClass("lb-top")||(c.children(".lb-top").removeClass("lb-top"),t.addClass("lb-top")),_(t.data("date")))},H=function(e,t){M(t.value);var n=S(t.value);n&&E(n.attr("id").substr(1))};r.addClass("lb"),i.toolbarEnabled&&(r.append(h=e("<div />",{"class":"lb-toolbar"}).append(e("<a />",{"class":"lb-pause-button",text:"Pause"}).bind("click",e.proxy(C,this)),e("<div />",{"class":"lb-timeline"}).append(e("<p />",{"class":"lb-timeline-label",text:"Waiting for updates..."}),p=e("<div />",{"class":"lb-timeline-slider"})),d=e("<span />",{"class":"lb-status"}))),p.slider({slide:H,disabled:!0})),i.tagFilter&&(f=e("<div />",{"class":"lb-tag-alert",html:"Showing all updates with the <b>"+i.tagFilter+"</b> tag. "}).appendTo(r),l=e("<a />",{href:"#",text:"View all updates"}).appendTo(f).bind("click",function(e){e.preventDefault(),i.tagFilter="",window.location.hash="",r.liveBlogLiteApi("reset"),r.trigger("begin")})),c=e("<div />",{"class":"lb-post-container"}).appendTo(r).scroll(P),i.height&&i.height>0&&c.height(i.height),r.delegate(".permalink","click",function(t){var n=e(t.currentTarget),r=n.attr("href"),i=r.substring(2,r.length);t.preventDefault(),console.log("wheeeee"),E(i)}),r.bind("update",function(t,n){var r=window.location.hash;n.updates&&(u===0&&(u=(new Date).getTime()),b(n.updates),O()),e(n.changes).each(function(e,t){g(t)}),n.deletes&&e(n.deletes).each(function(t,n){var r=e("#p"+n.id),i,s;r.length&&!r.hasClass("lb-comment")&&(i=r.data("date"),i===u&&(s=r.prev(":not(.lb-comment)"),s.length&&(u=s.data("date"))),i===a&&(s=r.next(":not(.lb-comment)"),s.length&&(a=s.data("date"))),O()),y(n)});if(r.length){var i,s,o=r.indexOf("p");o>-1&&(s=o+1,i=r.substring(s,r.length),E(i))}}),r.bind("end",function(t){e(".lb-pause-button",r).hide(),A(!1)}),i.alive===!1||i.end&&i.end<=new Date?(e(".lb-pause-button",r).hide(),A(!1)):(n=!1,A())}),r.delegate(".tag","click",function(t){i.tagFilter=e(t.currentTarget).text(),r.liveBlogLiteApi("reset"),r.unbind("end update"),r.undelegate(".permalink","click"),r.trigger("begin")}),i.tweetButtons&&(typeof twttr=="undefined"&&function(e,t,n){var r,i=e.getElementsByTagName(t)[0];e.getElementById(n)||(r=e.createElement(t),r.id=n,r.src="http://platform.twitter.com/widgets.js",i.parentNode.insertBefore(r,i))}(document,"script","twitter-wjs"),r.delegate(".lb-post","mouseenter",function(t){e(t.currentTarget).find(".twitter-share-button").fadeIn("fast")}),r.delegate(".lb-post","mouseleave",function(t){e(t.currentTarget).find(".twitter-share-button").fadeOut("fast")})),r.liveBlogLiteApi(i)}};return this.each(function(){t=t||{},i(t)})}})(jQuery);