(function(e){e.fn.liveBlogLiteApi=function(t){var n=this,r=arguments,i={callbackPrefix:"lb_"+(new Date).getTime()+"_",url:null,postId:null},s=n.data("lbl-state")||{},o=function(){n.data("lbl-state",s)},u={init:function(t){s.lastUpdate=s.lastUpdate||0,s.count=s.count||0,s.options=e.extend(!0,{},i,t),o(),u.fetch()},fetch:function(){var t,r=n.data("lbl-state"),i=r.options,s=i.callbackPrefix+r.count,a=function(e,t){t=t||[];var n,r,i,s,o,u={},a=e,f={1:"text",2:"image",4:"comment"};for(n=0,r=t.length;n<r;n+=1)o=t[n],u[o.m]={name:o.name,slug:o.slug};for(s in a)if(a.hasOwnProperty(s))for(n=0,r=a[s].length;n<a[s].length;n+=1)i=a[s][n],i.m&&(i.memberId=i.m,i.memberName=u[i.memberId].name,i.memberSlug=u[i.memberId].slug,delete i.m),i.t&&(i.date=new Date(i.t*1e3),delete i.t),i.type&&(i.type=f[i.type]||"unknown"),i.d&&(i.content=i.d,delete i.d),i.md&&i.md.caption&&(i.caption=i.md.caption||"",delete i.md.caption),i.md&&i.md.tags&&(i.tags=i.md.tags||[],delete i.md.tags);return a};i.url.substring(i.url.length-1)!=="/"&&(i.url+="/"),t=i.url+"live-update/"+i.postId+"/"+r.lastUpdate,e.ajax({dataType:"jsonp",jsonpCallback:s,url:t,success:function(e){r.lastUpdate=e.last_update,r.timer=setTimeout(u.fetch,e.int*1e3),r.count+=1,e.data&&n.trigger("update",a(e.data,e.members)),o()},error:function(e){r.timer=setTimeout(u.fetch,1e4),o()}})},pause:function(){s.paused=!0,clearTimeout(s.timer),o()},play:function(){s.paused=!1,u.fetch(),o()}};return this.each(function(){if(u[t])return u[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||!t)return u.init.apply(this,r);e.error("Method "+t+" does not exist on jQuery.liveBlogApi.")})}})(jQuery);