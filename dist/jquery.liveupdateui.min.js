(function(e){e.fn.liveUpdateUi=function(t){var n={toolbarEnabled:!1,timelineEnabled:!0,pageSize:0,tweetButtons:!0,height:0,linkParams:null,thumbnails:!0,dims:!0,thumbnailDimensions:{height:100,width:null},thumbnailExcludeFilter:null,postLimit:null,memberSettings:null,placeholderImage:"http://o.aolcdn.com/js/x.gif"},r=function(e){var t=document.createElement("DIV");return t.innerHTML=e,t.textContent||t.innerText},i=e(this),s=function(t){if(e.fn.liveUpdateApi){var s=e.extend(!0,{},n,t),o=!1,u=window.location.hash;if(u.length){var a,f,l=u.indexOf("tag=");l>-1&&(f=l+4,a=u.substring(f,u.length),a=decodeURIComponent(a),s.tagFilter=a)}s.linkParams&&(s.linkParams.charAt(0)==="?"||s.linkParams.charAt(0)==="&")&&(s.linkParams=s.linkParams.substr(1)),s.thumbnailExcludeFilter&&(s.thumbnailExcludeFilter=e.trim(s.thumbnailExcludeFilter));if(s.placeholderImage){var c=new Image;c.src=s.placeholderImage}if(s.thumbnailDimensions){var h=s.thumbnailDimensions.height?"height:"+s.thumbnailDimensions.height+"px;":"",p=s.thumbnailDimensions.width?"width:"+s.thumbnailDimensions.width+"px;":"";e('<style id="lb-style">.lb .lb-post img { '+p+h+" }</style>").appendTo("head")}i.bind("begin",function(t){i.empty();var n=!0,u=s.pageSize,a=[],f=0,l=0,c=null,h=null,p=null,d=null,v=null,m=null,g=null,y,b=0,w=!1,E=!1,S=function(t,n){var r=t.content,i=t.type,o=t.id,u=t.caption,a=t.tags,f=t.date,l=t.memberId,c,h,p,d,v,m,g,y,b,w,E=!n,S=e.extend({profileImage:null,featured:!1},s.memberSettings&&s.memberSettings[l]);c='<a href="#p'+o+'">'+_(f)+"</a>",S.featured||(c+=' by <span class="lb-blogger-name">'+t.memberName+"</span>");if(s.tagFilter)if(!a||e.inArray(s.tagFilter,a)===-1)return[];E?n=e("<p />",{id:"p"+o,"class":"lb-post"}).data("date",t.date.getTime()).toggleClass("lb-featured",S.featured||!1):(n.empty().addClass("lb-edited"),c+=" - edited"),n.data("imagesLoaded",!1),i==="text"||i==="comment"?(n.append(x(r,"lb-post-text")),i==="comment"?(n.addClass("lb-comment"),n.prepend(y=e('<div class="lb-comment-icon"/>').append(e('<div class="lb-comment-icon-dot"/>')))):n.data("comments")||n.data("comments",0)):i==="image"&&(s.thumbnails&&P(r)?(p=r,s.dims?h=e.getDynamicImageSrc(r,s.thumbnailDimensions.width,s.thumbnailDimensions.height):h=r.replace(/(\.gif|\.jpg|\.jpeg|\.png)$/,"_thumbnail$1")):h=r,n.append(d=e("<img />",{src:s.placeholderImage,"data-src":h||"","data-full-src":p||"",alt:"",title:"Click to view larger","class":"lb-pending"}),x(u,"lb-post-caption")),s.thumbnailDimensions&&(!s.thumbnails||h===r)&&(d.css("max-width",s.thumbnailDimensions.width||null),d.css("max-height",s.thumbnailDimensions.height||null))),n.append(g=e("<span />",{"class":"lb-post-info"}).append(e("<span />",{html:c,"class":"lb-post-timestamp"})));if(S.profileImage||S.featured)b=e("<span/>",{"class":"lb-post-author-tab"}),S.profileImage&&(w=e("<img/>",{"class":"lb-profile-image lb-pending",src:s.placeholderImage,"data-src":S.profileImage,alt:"",title:t.memberName}).appendTo(b)),S.featured&&b.append('<span class="lb-blogger-name">'+t.memberName+"</span>"),y?b.insertAfter(y):n.prepend(b);if(t.tags&&t.tags.length){var T=e("<ul />",{"class":"lb-post-tags"}).appendTo(g);e.each(t.tags,function(t,n){T.append(e("<li />",{html:'<a href="#tag='+encodeURIComponent(n)+'" class="tag" title="Show only updates with this tag">'+n+"</a>","class":t===0?"lb-first":null}))})}return s.tweetButtons&&(m=u||r,v=D(o,m),n.bind("mouseenter",function(e){n.unbind("mouseenter"),g.append(v),twttr.widgets.load(n.get(0))})),n},x=function(t,n){n=n||"lb-post-text";var r;return t,r=e("<span />",{html:t,"class":n}),r.find("a").attr("target","_blank"),s.linkParams&&r.find("a[href]").each(function(t,n){var r=e(n),i=r.attr("href"),o=i.indexOf("#"),u=(i.indexOf("?")===-1?"?":"&")+s.linkParams;o!==-1?i=i.substring(0,o)+u+i.substring(o):i+=u,r.attr("href",i)}),r.find("object, embed, applet, iframe, frame, input, select, textarea").remove(),r},T=function(t,n,r){n=n!=null?n:!0;var i=e("#p"+t.id,d),s=null,o=0,u=d.scrollTop(),f,l,c=function(t,n){i.data("date",n.data("date")),t.next(".lb-comment").andSelf().last().addClass("lb-comment-last").prev().removeClass("lb-comment-last"),n.data("comments",n.data("comments")+1),n.data("comments")>0&&(f=n.find(".lb-post-comments-label"),f.length||n.append(f=e("<span />",{"class":"lb-post-comments-label",text:"Comments"})))};i.length||(i=S(t),i.length&&(w&&i.addClass("lb-hidden"),t.p?(s=e("#p"+t.p,d),s.length?t.type==="comment"?(s.data("comments")>0?(l=s.nextUntil(":not(.lb-comment)",".lb-comment"),l.each(function(n,r){var s=e(r),o=Number(s.attr("id").substr(1));if(t.id>o)return i.insertBefore(s),!1;if(n===l.length-1)return i.insertAfter(s),!1})):i.insertAfter(s),c(i,s)):i.insertBefore(s):a.push(t)):r&&r.length?i.insertAfter(r):n===!1?i.appendTo(d):i.prependTo(d),o=i.outerHeight(),o&&u&&d.scrollTop(u+o),w&&i.removeClass("lb-hidden")))},N=function(t){var n=e("#p"+t.id,d),r=0,i=0,s=0,o=d.scrollTop();n.length?(r=n.outerHeight(),n=S(t,n),n&&(i=n.outerHeight(),s=i-r,s&&o&&d.scrollTop(o+s),n.hide().fadeIn(400))):H(t.id,t)},C=function(t){var n=e("#p"+t.id,d),r=0,i=d.scrollTop(),s=null;n.length?(r=n.outerHeight(),n.fadeOut(400,"swing",function(){n.hasClass("lb-comment-last")&&n.prev(".lb-comment").addClass("lb-comment-last"),n.hasClass("lb-comment")&&(s=n.prevAll(".lb-post:not(.lb-comment):first"),s.data("comments",s.data("comments")-1),s.data("comments")===0&&s.find(".lb-post-comments-label").remove()),n.remove(),r&&i&&d.scrollTop(i-r)})):H(t.id,null)},k=function(t,n){t=t||[];var r=t.length,i=this,s=10,o=Math.ceil(r/s),c=0,h=w,p=function(e,t){T(t,h);if(t.type!=="comment"&&t.date){var n=t.date.getTime();f=Math.min(f,n),l=Math.max(l,n)}},v=function(){e(t.splice(0,s)).each(e.proxy(p,i)),c===0&&!w&&Z(),t.length?setTimeout(v,0):n&&n(),c++};u>0&&r>u&&!a.length&&!d.children(".lb-post").length&&(a=t.splice(0,r-u),d.append(e("<a />",{"class":"lb-more-button lb-button",text:"Show earlier posts"})).click(e.proxy(A,this))),w||t.reverse(),setTimeout(v,0)},L=function(){var t=a.length;t&&e(a).each(function(e,t){T(t)})},A=function(t){var n=e(t.target),r=a.length,i=null,s=0,o=null;r&&(i=d.children(".lb-post:last"),s=Math.max(r-u,0),o=a.splice(s,u),e(o).each(function(e,t){T(t,i)})),a.length||n.remove()},O=function(t){var n=e("#p"+t,d);return o=!0,n.length&&d.stop().animate({scrollTop:n.get(0).offsetTop},{duration:"fast",complete:function(){o=!1}}),n},M=function(t){var n=null;return d.children(".lb-post:not(.lb-comment)").each(function(r,i){var s=e(i);if(s.data("date")===t||s.data("date")<t&&s.prev().data("date")>t)return n=s,!1}),n},_=function(e){e=new Date(e);var t="am",n=e.getHours(),r=e.getMinutes(),i="",s="",o="",u=new Date,a=new Date(u.getFullYear(),u.getMonth(),u.getDate());return n>=12&&(t="pm"),n===0?n=12:n>12&&(n-=12),r<10&&(r="0"+r),i=n+":"+r+t,s=e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear(),e.getTime()>=a.getTime()?o=i:o=s+", "+i,o},D=function(t,n){var i=window.location.href.replace(/\#.*$/,""),s=e("<a />",{"data-count":"none","data-text":'"'+r(n)+'"',"data-url":i+"#p"+t,href:"https://twitter.com/share","class":"twitter-share-button"}),o=document.createElement("DIV");return o.innerHtml=n,s},P=function(t){var n=!0,r,i;return t&&s.thumbnailExcludeFilter&&(r=String(s.thumbnailExcludeFilter).split(/\s*,\s*/i),e.each(r,function(e,r){if(r){i=new RegExp(r,"i");if(i.test(t))return n=!1,!1}})),n},H=function(e,t){if(a.length)for(var n=0;n<a.length;n++)if(a[n].id===e){t?a[n]=t:(a[n]=null,a.splice(n,1));break}},B=function(t){var r=e(t.target);n?(I(),r.text("Pause").attr("title","Stop receiving updates"),v.removeClass("lb-status-paused")):(q(),r.text("Resume").attr("title","Resume receiving updates"),v.addClass("lb-status-paused")),R()},j=function(t){e(".lb-pause-button",i).hide(),R(t)},F=function(){e(".lb-pause-button",i).show(),R()},I=function(){i.liveUpdateApi("play"),n=!1},q=function(){i.liveUpdateApi("pause"),n=!0},R=function(e){g&&(g.removeClass("lb-status-live"),e===!1?g.text("").hide():(n?g.text("Paused"):g.text("Live!").addClass("lb-status-live"),g.show()))},U=function(){m&&(m.slider("option",{min:f,max:l,disabled:!1}),J(null))},z=function(t){if(m){t=t||m.slider("value");var n=new Date(t),r=_(n);e(".lb-timeline-label",v).text(r)}},W=function(e){m&&(m.slider("value",e),z())},X=function(t){var n=e(t||window),r=null;return n.children(".lb-post").each(function(t,n){var i=e(n),s=i.height(),o=i.position().top,u=o+s;if(o<=0&&u>0)return r=i,!1}),r},V=function(t,n,r){t=e(t),n=n!=null?n:!1,r=r!=null?r:0;var i=d.height(),s=t.height(),o=t.position().top,u=o+s;return n===!0&&(r=s),u>r&&o<i-r},J=function(e){var t=X(d);t&&(t.hasClass("lb-top")||(d.children(".lb-top").removeClass("lb-top"),t.addClass("lb-top")),o||W(t.data("date"))),d.scrollTop()===0&&Q(0)},K=function(e,t){z(t.value);var n=M(t.value);n&&O(n.attr("id").substr(1))},Q=function(e){b=e,y.html("<b>"+e+"</b> new update"+(e!==1?"s":"")).toggle(e>0),e>0?c.slideDown(300):Boolean(s.tagFilter)||c.slideUp(300)},G=function(){s.tagFilter="",window.location.hash="_",i.liveUpdateApi("reset"),i.unbind("end update"),i.trigger("begin")},Y=function(t){t=e(t||d),t.find("img[data-src]").each(function(t,n){var r=e(n);r.attr("src",r.attr("data-src")).removeAttr("data-src").removeClass("lb-pending")})},Z=function(t){var n=!1;d.children(".lb-post").each(function(t,r){var i=e(r);if(!i.data("imagesLoaded"))if(V(i,!1,-500))Y(i),i.data("imagesLoaded",!0),n=!0;else if(n)return!1})},et=function(t){var r=window.location.hash,i=0;if(t.updates){if(s.postLimit){var o=d.find(".lb-post");if(o.length>s.postLimit){var c=o.length-s.postLimit;o.slice(-c).remove()}}U(),w?(d.scrollTop()>0?i=t.updates.length:s.tagFilter&&e.each(t.updates,function(t,n){if(!n.tags||n.tags&&e.inArray(s.tagFilter,n.tags)===-1)i+=1}),i>0&&Q(b+i)):a.length&&u===0&&L()}t.changes&&e(t.changes).each(function(e,t){N(t)}),t.deletes&&e(t.deletes).each(function(t,n){var r=e("#p"+n.id),i,s;r.length&&!r.hasClass("lb-comment")&&(i=r.data("date"),i===f&&(s=r.prev(":not(.lb-comment)"),s.length&&(f=s.data("date"))),i===l&&(s=r.next(":not(.lb-comment)"),s.length&&(l=s.data("date"))),U()),C(n)});if(r.length){var h,p,v=r.indexOf("p"),m;v===1&&(p=v+1,h=r.substring(p,r.length),m=O(h),m.length&&e(window).scrollTop(d.offset().top))}setTimeout(function(){Z()},0),w=!0,n&&E&&(E=!1,I(),F())};i.addClass("lb"),s.toolbarEnabled&&(i.append(v=e("<div />",{"class":"lb-toolbar"}).append(e("<a />",{"class":"lb-pause-button lb-button",text:"Pause",title:"Stop receiving updates"}).bind("click",e.proxy(B,this)))),s.timelineEnabled&&e("<div />",{"class":"lb-timeline"}).append(e("<p />",{"class":"lb-timeline-label",text:"Waiting for updates..."}),m=e("<div />",{"class":"lb-timeline-slider"})).appendTo(v),g=e("<span />",{"class":"lb-status"}).hide().appendTo(v),m&&m.slider({slide:K,disabled:!0})),c=e("<div />",{"class":"lb-alert"}).appendTo(i).append(y=e("<a />",{"class":"lb-unread-count",title:"Jump to newest update"}).hide().click(function(e){e.preventDefault(),s.tagFilter?G():d.stop().animate({scrollTop:0},{duration:"fast"})})).hide(),s.tagFilter&&(c.show().append(h=e("<span />",{"class":"lb-tag-filter",html:"Showing all updates with the <b>"+s.tagFilter+"</b> tag. "})),p=e("<a />",{href:"#",text:"View all updates"}).appendTo(h).bind("click",function(e){e.preventDefault(),G()})),d=e("<div />",{"class":"lb-post-container"}).appendTo(i).scroll(e.throttle(250,J)).scroll(e.debounce(100,Z)),s.height&&s.height>0&&d.height(s.height),i.bind("update",function(e,t){!w&&!n&&(E=!0,q(),j()),t.updates?(s.postLimit&&s.postLimit<t.updates.length&&t.updates.splice(0,t.updates.length-s.postLimit),f===0&&(f=(new Date).getTime()),k(t.updates,function(){et(t)})):et(t)}),i.bind("end",function(e){j(!1)}),s.alive===!1||s.end&&s.end<=new Date?j(!1):(n=!1,R())}),i.delegate(".tag","click",function(t){s.tagFilter=e(t.currentTarget).text(),i.liveUpdateApi("reset"),i.unbind("end update"),i.trigger("begin")}),i.delegate("img:not(.lb-profile-image)","click",function(t){var n=e(t.currentTarget),r=n.attr("data-full-src"),i=r?r:n.attr("src"),s=e("<div />",{"class":"lb-img-loading"}),o=e("<span />",{html:"Loading&hellip;"}),u=e("<img />",{src:i}),a=e("<div />").prependTo("body");s.insertBefore(n),n.detach().appendTo(s),o.appendTo(s).hide().fadeIn("fast"),u.imagesLoaded(function(){var t=e(window),r=100,i=t.width()-r,o=t.height()-r;n.detach().insertAfter(s),s.remove(),a.append(u),u.width()>i&&(u.width(i),u.height()>o&&(u.height(o),u.width(""))),u.height()>o&&(u.height(o),u.width()>i&&(u.width(i),u.height(""))),a.dialog({height:"auto",modal:!0,width:"auto",dialogClass:"lb-image-dialog",zIndex:9e3}),e(".ui-widget-overlay").bind("click",function(e){a.dialog("destroy")})})}),e.browser.msie&&parseInt(e.browser.version,10)<=6&&i.delegate(".lb-button","hover",function(t){e(this).toggleClass("lb-hover")}),s.tweetButtons&&(typeof twttr=="undefined"&&function(e,t,n){var r,i=e.getElementsByTagName(t)[0];e.getElementById(n)||(r=e.createElement(t),r.id=n,r.src="http://platform.twitter.com/widgets.js",i.parentNode.insertBefore(r,i))}(document,"script","twitter-wjs"),i.delegate(".lb-post","mouseenter",function(t){e(t.currentTarget).find(".twitter-share-button").fadeIn("fast")}),i.delegate(".lb-post","mouseleave",function(t){e(t.currentTarget).find(".twitter-share-button").fadeOut("fast")})),i.liveUpdateApi(s)}};return this.each(function(){t=t||{},s(t)})}})(jQuery);